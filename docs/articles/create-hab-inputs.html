<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using CVPIA Data Packages to Generate Model Inputs â€¢ cvpiaData</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using CVPIA Data Packages to Generate Model Inputs">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cvpiaData</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/create-hab-inputs.html">Create Habitat Inputs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/flowwest/cvpiaData">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Using CVPIA Data Packages to Generate Model Inputs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FlowWest/cvpiaData/blob/master/vignettes/create-hab-inputs.Rmd"><code>vignettes/create-hab-inputs.Rmd</code></a></small>
      <div class="hidden name"><code>create-hab-inputs.Rmd</code></div>

    </div>

    
    
<p>The following vignette provides a method for generating spawning, fry, juvenile, and floodplain rearing habitat inputs for the CVPIA salmon life cycle model. Readers will get a sense of how to use the data and functions from the <a href="https://flowwest.github.io/cvpiaFlow/">cvpiaFlow</a> and <a href="https://flowwest.github.io/cvpiaHabitat/">cvpiaHabitat</a> packages. They will also be able to generate additional habitat inputs by modifying the functions within this document to accommodate new scenarios for the model.</p>
<div id="helper-functions-and-libraries" class="section level2">
<h2 class="hasAnchor">
<a href="#helper-functions-and-libraries" class="anchor"></a>Helper functions and Libraries</h2>
<p>The following packages are used by the functions. The packages <a href="http://dplyr.tidyverse.org/">dplyr</a>, <a href="http://tidyr.tidyverse.org/">tidyr</a>, and <a href="http://lubridate.tidyverse.org/">lubridate</a> are useful for data manipulations. The package <a href="http://purrr.tidyverse.org/">purrr</a> is a functional programming toolkit to replace for loops.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyr)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(purrr)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(lubridate)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(cvpiaHabitat)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(cvpiaFlow)</span></code></pre></div>
<p>These functions are called by the other habitat setting functions.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># returns flow for each month of a watershed during simulation window</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>get_flow &lt;-<span class="st"> </span><span class="cf">function</span>(watershed, <span class="dt">years=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1980</span>, <span class="dv">1999</span>)) {</span>
<span id="cb2-3"><a href="#cb2-3"></a>  </span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="co"># get the flow values at the dates</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>    dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(cvpiaFlow<span class="op">::</span>flows_cfs, date, watershed), </span>
<span id="cb2-6"><a href="#cb2-6"></a>                                             lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(date) <span class="op">&gt;=</span><span class="st"> </span>years[<span class="dv">1</span>], </span>
<span id="cb2-7"><a href="#cb2-7"></a>                                             lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(date) <span class="op">&lt;=</span><span class="st"> </span>years[<span class="dv">2</span>]), <span class="dv">2</span>)</span>
<span id="cb2-8"><a href="#cb2-8"></a>}</span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co"># transforms to array data structure for SIT model input, [watersheds, months, years]</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>create_SIT_array &lt;-<span class="st"> </span><span class="cf">function</span>(input) {</span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a>  output &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="ot">NA</span>, <span class="dt">dim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(input), <span class="dv">12</span>, <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(input) <span class="op">/</span><span class="st"> </span><span class="dv">12</span>))</span>
<span id="cb2-14"><a href="#cb2-14"></a>  index &lt;-<span class="st">  </span><span class="dv">1</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">1</span>, <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(input), <span class="dv">12</span>)) {</span>
<span id="cb2-16"><a href="#cb2-16"></a>    output[ , , index] &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(input[ , i<span class="op">:</span>(i <span class="op">+</span><span class="st"> </span><span class="dv">11</span>)])</span>
<span id="cb2-17"><a href="#cb2-17"></a>    index &lt;-<span class="st"> </span>index <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb2-18"><a href="#cb2-18"></a>  }</span>
<span id="cb2-19"><a href="#cb2-19"></a>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(output)</span>
<span id="cb2-20"><a href="#cb2-20"></a></span>
<span id="cb2-21"><a href="#cb2-21"></a>}</span></code></pre></div>
</div>
<div id="spawning-habitat" class="section level2">
<h2 class="hasAnchor">
<a href="#spawning-habitat" class="anchor"></a>Spawning Habitat</h2>
<p>The following function outputs the three dimensional array that is used by the life cycle model to represent spawning habitat for each month and year in the simulation window. It handles the special case of Upper Sacramento River, which has two separate WUA area estimates for when the A.C.I.D. boards are in and out. The function takes the additional argument <code>month</code> for Upper Sacramento River in order to use the correct WUA relationship given the state of the boards. The A.C.I.D boards are in April 1st - October 31st. The function also sets the spawning area value to <code>NA</code> for watersheds without spawning. Additionally, here is the source code for <a href="https://github.com/FlowWest/cvpiaHabitat/blob/master/R/set-spawning-habitat.R">set_spawning_habitat.</a></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>get_spawn_hab_all &lt;-<span class="st"> </span><span class="cf">function</span>(species) {</span>
<span id="cb3-2"><a href="#cb3-2"></a>  </span>
<span id="cb3-3"><a href="#cb3-3"></a>  watersheds &lt;-<span class="st"> </span>cvpiaHabitat<span class="op">::</span>modeling_exist <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(FR_spawn), Watershed <span class="op">!=</span><span class="st"> 'Upper Sacramento River'</span>, Watershed <span class="op">!=</span><span class="st"> 'Upper Mid Sac Region'</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(Watershed)</span>
<span id="cb3-6"><a href="#cb3-6"></a>  </span>
<span id="cb3-7"><a href="#cb3-7"></a>  most &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span>(watersheds, <span class="cf">function</span>(watershed) {</span>
<span id="cb3-8"><a href="#cb3-8"></a>    flows &lt;-<span class="st"> </span><span class="kw">get_flow</span>(watershed, <span class="dt">years=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1979</span>, <span class="dv">1999</span>))</span>
<span id="cb3-9"><a href="#cb3-9"></a>    habitat &lt;-<span class="st"> </span>cvpiaHabitat<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cvpiaHabitat/man/set_spawning_habitat.html">set_spawning_habitat</a></span>(watershed, </span>
<span id="cb3-10"><a href="#cb3-10"></a>                                                  <span class="dt">species =</span> species,</span>
<span id="cb3-11"><a href="#cb3-11"></a>                                                  <span class="dt">flow =</span> flows)</span>
<span id="cb3-12"><a href="#cb3-12"></a>    <span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(</span>
<span id="cb3-13"><a href="#cb3-13"></a>      <span class="dt">year =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1979</span><span class="op">:</span><span class="dv">1999</span>, <span class="dt">each =</span> <span class="dv">12</span>),</span>
<span id="cb3-14"><a href="#cb3-14"></a>      <span class="dt">month =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dv">21</span>),</span>
<span id="cb3-15"><a href="#cb3-15"></a>      <span class="dt">watershed =</span> watershed, </span>
<span id="cb3-16"><a href="#cb3-16"></a>      <span class="dt">hab_sq_m =</span> habitat)</span>
<span id="cb3-17"><a href="#cb3-17"></a>  })</span>
<span id="cb3-18"><a href="#cb3-18"></a>  </span>
<span id="cb3-19"><a href="#cb3-19"></a>  <span class="co"># deal with sacramento special cases</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>  <span class="co"># upper sac</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>  up_sac_flows &lt;-<span class="st"> </span><span class="kw">get_flow</span>(<span class="st">'Upper Sacramento River'</span>, <span class="dt">years=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1979</span>, <span class="dv">1999</span>))</span>
<span id="cb3-22"><a href="#cb3-22"></a>  months &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dv">21</span>)</span>
<span id="cb3-23"><a href="#cb3-23"></a>  up_sac_hab &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map2.html">map2_dbl</a></span>(months, up_sac_flows, <span class="cf">function</span>(month, flow) {</span>
<span id="cb3-24"><a href="#cb3-24"></a>    cvpiaHabitat<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cvpiaHabitat/man/set_spawning_habitat.html">set_spawning_habitat</a></span>(<span class="st">'Upper Sacramento River'</span>, </span>
<span id="cb3-25"><a href="#cb3-25"></a>                                       <span class="dt">species =</span> species, </span>
<span id="cb3-26"><a href="#cb3-26"></a>                                       <span class="dt">flow =</span> flow, <span class="dt">month =</span> month)</span>
<span id="cb3-27"><a href="#cb3-27"></a>  })</span>
<span id="cb3-28"><a href="#cb3-28"></a>  </span>
<span id="cb3-29"><a href="#cb3-29"></a>  up_sac &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(</span>
<span id="cb3-30"><a href="#cb3-30"></a>    <span class="dt">year =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1979</span><span class="op">:</span><span class="dv">1999</span>, <span class="dt">each =</span> <span class="dv">12</span>),</span>
<span id="cb3-31"><a href="#cb3-31"></a>    <span class="dt">month =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dv">21</span>),</span>
<span id="cb3-32"><a href="#cb3-32"></a>    <span class="dt">watershed =</span> <span class="st">'Upper Sacramento River'</span>, </span>
<span id="cb3-33"><a href="#cb3-33"></a>    <span class="dt">hab_sq_m =</span> up_sac_hab)</span>
<span id="cb3-34"><a href="#cb3-34"></a>  </span>
<span id="cb3-35"><a href="#cb3-35"></a>  hab &lt;-<span class="st">   </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(most, up_sac) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="st">    </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span>(watershed, hab_sq_m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="st">`</span><span class="dt">Sutter Bypass</span><span class="st">`</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="ot">NA</span>, <span class="dv">252</span>),</span>
<span id="cb3-38"><a href="#cb3-38"></a>                     <span class="st">`</span><span class="dt">Yolo Bypass</span><span class="st">`</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="ot">NA</span>, <span class="dv">252</span>),</span>
<span id="cb3-39"><a href="#cb3-39"></a>                     <span class="st">`</span><span class="dt">Upper-mid Sacramento River</span><span class="st">`</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="ot">NA</span>, <span class="dv">252</span>),</span>
<span id="cb3-40"><a href="#cb3-40"></a>                     <span class="st">`</span><span class="dt">Lower-mid Sacramento River</span><span class="st">`</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="ot">NA</span>, <span class="dv">252</span>),</span>
<span id="cb3-41"><a href="#cb3-41"></a>                     <span class="st">`</span><span class="dt">Lower Sacramento River</span><span class="st">`</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="ot">NA</span>, <span class="dv">252</span>),</span>
<span id="cb3-42"><a href="#cb3-42"></a>                     <span class="st">`</span><span class="dt">San Joaquin River</span><span class="st">`</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="ot">NA</span>, <span class="dv">252</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-43"><a href="#cb3-43"></a><span class="st">    </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(watershed, habitat, <span class="op">-</span>year, <span class="op">-</span>month) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-44"><a href="#cb3-44"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">date =</span> lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(year, month, <span class="dv">1</span>, <span class="st">'-'</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-45"><a href="#cb3-45"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(date, watershed, habitat) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-46"><a href="#cb3-46"></a><span class="st">    </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span>(date, habitat) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-47"><a href="#cb3-47"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(cvpiaData<span class="op">::</span>watershed_ordering) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-48"><a href="#cb3-48"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(order) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-49"><a href="#cb3-49"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>watershed, <span class="op">-</span>order) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-50"><a href="#cb3-50"></a><span class="st">    </span><span class="kw"><a href="../reference/create_Sit_array.html">create_SIT_array</a></span>()</span>
<span id="cb3-51"><a href="#cb3-51"></a>  </span>
<span id="cb3-52"><a href="#cb3-52"></a>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(hab)</span>
<span id="cb3-53"><a href="#cb3-53"></a>}</span></code></pre></div>
<p>To create habitat arrays for the different species, you can call the above function with the appropriate species argument.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>fr_spawn &lt;-<span class="st"> </span><span class="kw">get_spawn_hab_all</span>(<span class="st">'fr'</span>) <span class="co">#fall run</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>sr_spawn &lt;-<span class="st"> </span><span class="kw">get_spawn_hab_all</span>(<span class="st">'sr'</span>) <span class="co">#spring run</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>st_spawn &lt;-<span class="st"> </span><span class="kw">get_spawn_hab_all</span>(<span class="st">'st'</span>) <span class="co">#steelhead</span></span></code></pre></div>
<p>If you wish to modify the above function to make a new scenario, a possible way to override the default data output from <code><a href="../reference/load_baseline_data.html">cvpiaData::load_baseline_data</a></code> is as follows:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>all_model_inputs &lt;-<span class="st"> </span>cvpiaData<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cvpiaData/man/load_baseline_data.html">load_baseline_data</a></span>(<span class="st">'fall'</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># user must define get_spawn_hab_all_modified to their specifications</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>all_model_inputs<span class="op">$</span>IChab.spawn &lt;-<span class="st"> </span><span class="kw">get_spawn_hab_all_modified</span>(<span class="st">'fr'</span>) </span></code></pre></div>
<p>Or, you could swap out the watershedâ€™s values with a vector of new values. This vector must be of length 252, with the first value representing the habitat value for 01/1979 and the last 12/1999.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>fr_modified &lt;-<span class="st"> </span>cvpiaData<span class="op">::</span>fr_spawn <span class="co">#copy baseline fall run spawning habitat</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>new_upper_sac_vals &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">252</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co"># upper sacramento is the first watershed, see cvpiaData::watershed_ordering</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>fr_modified[<span class="dv">1</span>,,] &lt;-<span class="st"> </span>new_upper_sac_vals </span>
<span id="cb6-5"><a href="#cb6-5"></a>all_model_inputs<span class="op">$</span>IChab.spawn &lt;-<span class="st"> </span>fr_modified[<span class="dv">1</span>,,]</span></code></pre></div>
</div>
<div id="rearing-habitat" class="section level2">
<h2 class="hasAnchor">
<a href="#rearing-habitat" class="anchor"></a>Rearing Habitat</h2>
<p>This function generates either the fry or juvenile rearing habitat in each watershed for a specified species. The function handles the two special cases, the Upper Sacramento River and the Lower-mid Sacramento River. The <code>set_instream_habitat</code> function takes the additional argument <code>month</code> for Upper Sacramento River in order to use the correct WUA relationship given the state of the boards. The A.C.I.D boards are in April 1st - October 31st. The Lower-mid Sacramento River has two flow representations, one above Fremont Weir and one below. For the Lower-Mid Sacramento river, the <code>set_instream_habitat</code> function takes the additional argument <code>flow2</code> and calculates the habitat at each flow then sums them proportional to the length of stream above and below the weir.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>get_rear_hab_all &lt;-<span class="st"> </span><span class="cf">function</span>(species, life_stage) {</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a>  watersheds &lt;-<span class="st"> </span>cvpiaData<span class="op">::</span>watershed_ordering <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>(watershed  <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Sutter Bypass'</span>,</span>
<span id="cb7-5"><a href="#cb7-5"></a>                             <span class="st">'Lower-mid Sacramento River'</span>, <span class="st">'Yolo Bypass'</span>))) <span class="op">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(watershed)</span>
<span id="cb7-7"><a href="#cb7-7"></a>  </span>
<span id="cb7-8"><a href="#cb7-8"></a>  most &lt;-<span class="st"> </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span>(watersheds, <span class="cf">function</span>(watershed) {</span>
<span id="cb7-9"><a href="#cb7-9"></a>    flows &lt;-<span class="st"> </span><span class="kw">get_flow</span>(watershed)</span>
<span id="cb7-10"><a href="#cb7-10"></a>    habitat &lt;-<span class="st"> </span>cvpiaHabitat<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cvpiaHabitat/man/set_instream_habitat.html">set_instream_habitat</a></span>(watershed, </span>
<span id="cb7-11"><a href="#cb7-11"></a>                                                  <span class="dt">species =</span> species,</span>
<span id="cb7-12"><a href="#cb7-12"></a>                                                  <span class="dt">life_stage =</span> life_stage, </span>
<span id="cb7-13"><a href="#cb7-13"></a>                                                  <span class="dt">flow =</span> flows)</span>
<span id="cb7-14"><a href="#cb7-14"></a>    <span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(</span>
<span id="cb7-15"><a href="#cb7-15"></a>      <span class="dt">year =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1980</span><span class="op">:</span><span class="dv">1999</span>, <span class="dt">each =</span> <span class="dv">12</span>),</span>
<span id="cb7-16"><a href="#cb7-16"></a>      <span class="dt">month =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dv">20</span>),</span>
<span id="cb7-17"><a href="#cb7-17"></a>      <span class="dt">watershed =</span> watershed, </span>
<span id="cb7-18"><a href="#cb7-18"></a>      <span class="dt">hab_sq_m =</span> habitat)</span>
<span id="cb7-19"><a href="#cb7-19"></a>  })</span>
<span id="cb7-20"><a href="#cb7-20"></a>  </span>
<span id="cb7-21"><a href="#cb7-21"></a>  <span class="co"># deal with sacramento special cases</span></span>
<span id="cb7-22"><a href="#cb7-22"></a>  <span class="co"># lower-mid sac</span></span>
<span id="cb7-23"><a href="#cb7-23"></a>  low_mid_sac_flow1 &lt;-<span class="st"> </span><span class="kw">get_flow</span>(<span class="st">'Lower-mid Sacramento River1'</span>)</span>
<span id="cb7-24"><a href="#cb7-24"></a>  low_mid_sac_flow2 &lt;-<span class="st"> </span><span class="kw">get_flow</span>(<span class="st">'Lower-mid Sacramento River2'</span>)</span>
<span id="cb7-25"><a href="#cb7-25"></a>  </span>
<span id="cb7-26"><a href="#cb7-26"></a>  low_mid_sac_hab &lt;-<span class="st"> </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map2.html">map2_dbl</a></span>(low_mid_sac_flow1, low_mid_sac_flow2, <span class="cf">function</span>(flow, flow2) {</span>
<span id="cb7-27"><a href="#cb7-27"></a>    cvpiaHabitat<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cvpiaHabitat/man/set_instream_habitat.html">set_instream_habitat</a></span>(<span class="st">'Lower-mid Sacramento River'</span>, </span>
<span id="cb7-28"><a href="#cb7-28"></a>                                       <span class="dt">species =</span> species, </span>
<span id="cb7-29"><a href="#cb7-29"></a>                                       <span class="dt">life_stage =</span> life_stage, </span>
<span id="cb7-30"><a href="#cb7-30"></a>                                       <span class="dt">flow =</span> flow, <span class="dt">flow2 =</span> flow2)</span>
<span id="cb7-31"><a href="#cb7-31"></a>  })</span>
<span id="cb7-32"><a href="#cb7-32"></a>  </span>
<span id="cb7-33"><a href="#cb7-33"></a>  low_mid_sac &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(</span>
<span id="cb7-34"><a href="#cb7-34"></a>    <span class="dt">year =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1980</span><span class="op">:</span><span class="dv">1999</span>, <span class="dt">each =</span> <span class="dv">12</span>),</span>
<span id="cb7-35"><a href="#cb7-35"></a>    <span class="dt">month =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dv">20</span>),</span>
<span id="cb7-36"><a href="#cb7-36"></a>    <span class="dt">watershed =</span> <span class="st">'Lower-mid Sacramento River'</span>, </span>
<span id="cb7-37"><a href="#cb7-37"></a>    <span class="dt">hab_sq_m =</span> low_mid_sac_hab)</span>
<span id="cb7-38"><a href="#cb7-38"></a>  </span>
<span id="cb7-39"><a href="#cb7-39"></a>  hab &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(most, low_mid_sac) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-40"><a href="#cb7-40"></a><span class="st">    </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span>(watershed, hab_sq_m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-41"><a href="#cb7-41"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="st">`</span><span class="dt">Sutter Bypass</span><span class="st">`</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="ot">NA</span>, <span class="dv">240</span>),</span>
<span id="cb7-42"><a href="#cb7-42"></a>                     <span class="st">`</span><span class="dt">Yolo Bypass</span><span class="st">`</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="ot">NA</span>, <span class="dv">240</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-43"><a href="#cb7-43"></a><span class="st">    </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(watershed, habitat, <span class="op">-</span>year, <span class="op">-</span>month) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-44"><a href="#cb7-44"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">date =</span> lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(year, month, <span class="dv">1</span>, <span class="st">'-'</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-45"><a href="#cb7-45"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(date, watershed, habitat) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-46"><a href="#cb7-46"></a><span class="st">    </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span>(date, habitat) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-47"><a href="#cb7-47"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(cvpiaData<span class="op">::</span>watershed_ordering) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-48"><a href="#cb7-48"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(order) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-49"><a href="#cb7-49"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>watershed, <span class="op">-</span>order) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-50"><a href="#cb7-50"></a><span class="st">    </span><span class="kw"><a href="../reference/create_Sit_array.html">create_SIT_array</a></span>()</span>
<span id="cb7-51"><a href="#cb7-51"></a>  </span>
<span id="cb7-52"><a href="#cb7-52"></a>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(hab)</span>
<span id="cb7-53"><a href="#cb7-53"></a>}</span></code></pre></div>
<p>To create habitat arrays for the different species, you can call the above function with the appropriate species argument.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>fr_fry &lt;-<span class="st"> </span><span class="kw">get_rear_hab_all</span>(<span class="st">'fr'</span>, <span class="st">'fry'</span>) <span class="co">#fall run</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>sr_fry &lt;-<span class="st"> </span><span class="kw">get_rear_hab_all</span>(<span class="st">'sr'</span>, <span class="st">'fry'</span>) <span class="co">#spring run</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>st_fry &lt;-<span class="st"> </span><span class="kw">get_rear_hab_all</span>(<span class="st">'st'</span>, <span class="st">'fry'</span>) <span class="co">#steelhead</span></span>
<span id="cb8-4"><a href="#cb8-4"></a></span>
<span id="cb8-5"><a href="#cb8-5"></a>fr_juv &lt;-<span class="st"> </span><span class="kw">get_rear_hab_all</span>(<span class="st">'fr'</span>, <span class="st">'juv'</span>) <span class="co">#fall run</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>sr_juv &lt;-<span class="st"> </span><span class="kw">get_rear_hab_all</span>(<span class="st">'sr'</span>, <span class="st">'juv'</span>) <span class="co">#spring run</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>st_juv &lt;-<span class="st"> </span><span class="kw">get_rear_hab_all</span>(<span class="st">'st'</span>, <span class="st">'juv'</span>) <span class="co">#steelhead</span></span></code></pre></div>
<p>If you wish to modify the above function to make a new scenario, a possible way to override the default data output from <code><a href="../reference/load_baseline_data.html">cvpiaData::load_baseline_data</a></code> is as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>all_model_inputs &lt;-<span class="st"> </span>cvpiaData<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cvpiaData/man/load_baseline_data.html">load_baseline_data</a></span>(<span class="st">'fall'</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co"># user must define get_rear_hab_all_modified to their specifications</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>all_model_inputs<span class="op">$</span>IChab.fry &lt;-<span class="st"> </span><span class="kw">get_rear_hab_all_modified</span>(<span class="st">'fr'</span>, <span class="st">'fry'</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a>all_model_inputs<span class="op">$</span>IChab.juv &lt;-<span class="st"> </span><span class="kw">get_rear_hab_all_modified</span>(<span class="st">'fr'</span>, <span class="st">'juv'</span>)</span></code></pre></div>
<p>Or, you could swap out the watershedâ€™s values with a vector of new values. This vector must be of length 240, with the first value representing the habitat value for 01/1980 and the last 12/1999.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>fr_modified &lt;-<span class="st"> </span>cvpiaData<span class="op">::</span>fr_fry <span class="co">#copy baseline fall run fry rearing habitat</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>new_upper_sac_vals &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">240</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co"># upper sacramento is the first watershed, see cvpiaData::watershed_ordering</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>fr_modified[<span class="dv">1</span>,,] &lt;-<span class="st"> </span>new_upper_sac_vals </span>
<span id="cb10-5"><a href="#cb10-5"></a>all_model_inputs<span class="op">$</span>IChab.fry &lt;-<span class="st"> </span>fr_modified[<span class="dv">1</span>,,]</span></code></pre></div>
</div>
<div id="floodplain-habitat" class="section level2">
<h2 class="hasAnchor">
<a href="#floodplain-habitat" class="anchor"></a>Floodplain Habitat</h2>
<p>This function sets the floodplain rearing habitat for all the watersheds. The Lower-mid Sacramento River has two flow representations, one above Fremont Weir and one below. The flow value below the weir is used to calculate floodplain habitat area.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>get_floodplain_hab_all &lt;-<span class="st"> </span><span class="cf">function</span>(watersheds, species) {</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>  watersheds_fp &lt;-<span class="st"> </span>cvpiaData<span class="op">::</span>watershed_ordering <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>(watershed  <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Sutter Bypass'</span>,<span class="st">'Yolo Bypass'</span>, </span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="st">'Lower-mid Sacramento River'</span>, <span class="st">'Upper Sacramento River'</span>,</span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="st">'Upper-mid Sacramento River'</span>, <span class="st">'Lower Sacramento River'</span>))) <span class="op">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(watershed)</span>
<span id="cb11-8"><a href="#cb11-8"></a>  </span>
<span id="cb11-9"><a href="#cb11-9"></a>  most &lt;-<span class="st"> </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span>(watersheds, <span class="cf">function</span>(watershed) {</span>
<span id="cb11-10"><a href="#cb11-10"></a>    flows &lt;-<span class="st"> </span><span class="kw">get_flow</span>(watershed)</span>
<span id="cb11-11"><a href="#cb11-11"></a>    habitat &lt;-<span class="st"> </span>cvpiaHabitat<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cvpiaHabitat/man/acres_to_square_meters.html">acres_to_square_meters</a></span>(</span>
<span id="cb11-12"><a href="#cb11-12"></a>      cvpiaHabitat<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cvpiaHabitat/man/set_floodplain_habitat.html">set_floodplain_habitat</a></span>(watershed, species, flows))</span>
<span id="cb11-13"><a href="#cb11-13"></a>    </span>
<span id="cb11-14"><a href="#cb11-14"></a>    <span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(</span>
<span id="cb11-15"><a href="#cb11-15"></a>      <span class="dt">year =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1980</span><span class="op">:</span><span class="dv">1999</span>, <span class="dt">each =</span> <span class="dv">12</span>),</span>
<span id="cb11-16"><a href="#cb11-16"></a>      <span class="dt">month =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dv">20</span>),</span>
<span id="cb11-17"><a href="#cb11-17"></a>      <span class="dt">watershed =</span> watershed, </span>
<span id="cb11-18"><a href="#cb11-18"></a>      <span class="dt">hab_sq_m =</span> habitat)</span>
<span id="cb11-19"><a href="#cb11-19"></a>  })</span>
<span id="cb11-20"><a href="#cb11-20"></a>  </span>
<span id="cb11-21"><a href="#cb11-21"></a>  <span class="co"># deal with sac, already in square meters</span></span>
<span id="cb11-22"><a href="#cb11-22"></a>  <span class="co"># upper sac</span></span>
<span id="cb11-23"><a href="#cb11-23"></a>  up_sac_flow &lt;-<span class="st"> </span><span class="kw">get_flow</span>(<span class="st">'Upper Sacramento River'</span>)</span>
<span id="cb11-24"><a href="#cb11-24"></a>  up_mid_sac_flow &lt;-<span class="st"> </span><span class="kw">get_flow</span>(<span class="st">'Upper-mid Sacramento River'</span>)</span>
<span id="cb11-25"><a href="#cb11-25"></a>  low_sac_flow &lt;-<span class="st"> </span><span class="kw">get_flow</span>(<span class="st">'Lower Sacramento River'</span>)</span>
<span id="cb11-26"><a href="#cb11-26"></a>  </span>
<span id="cb11-27"><a href="#cb11-27"></a>  up_sac_fp &lt;-<span class="st"> </span>cvpiaHabitat<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cvpiaHabitat/man/set_floodplain_habitat.html">set_floodplain_habitat</a></span>(<span class="st">'Upper Sacramento River'</span>, species, up_sac_flow)</span>
<span id="cb11-28"><a href="#cb11-28"></a>  up_mid_sac_fp &lt;-<span class="st"> </span>cvpiaHabitat<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cvpiaHabitat/man/set_floodplain_habitat.html">set_floodplain_habitat</a></span>(<span class="st">'Upper-mid Sacramento River'</span>, species, up_mid_sac_flow)</span>
<span id="cb11-29"><a href="#cb11-29"></a>  low_sac_fp &lt;-<span class="st"> </span>cvpiaHabitat<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cvpiaHabitat/man/set_floodplain_habitat.html">set_floodplain_habitat</a></span>(<span class="st">'Lower Sacramento River'</span>, species, low_sac_flow)</span>
<span id="cb11-30"><a href="#cb11-30"></a>  </span>
<span id="cb11-31"><a href="#cb11-31"></a>  <span class="co"># lower-mid sacramento </span></span>
<span id="cb11-32"><a href="#cb11-32"></a>  low_mid_sac_flows1 &lt;-<span class="st"> </span><span class="kw">get_flow</span>(<span class="st">"Lower-mid Sacramento River1"</span>) </span>
<span id="cb11-33"><a href="#cb11-33"></a>  low_mid_sac_flows2 &lt;-<span class="st"> </span><span class="kw">get_flow</span>(<span class="st">"Lower-mid Sacramento River2"</span>) </span>
<span id="cb11-34"><a href="#cb11-34"></a>  low_mid_sac_fp &lt;-<span class="st"> </span>cvpiaHabitat<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cvpiaHabitat/man/set_floodplain_habitat.html">set_floodplain_habitat</a></span>(<span class="st">'Lower-mid Sacramento River'</span>, species,</span>
<span id="cb11-35"><a href="#cb11-35"></a>                                                         low_mid_sac_flows1, <span class="dt">flow2 =</span> low_mid_sac_flows2)</span>
<span id="cb11-36"><a href="#cb11-36"></a>  sac &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(</span>
<span id="cb11-37"><a href="#cb11-37"></a>    <span class="dt">year =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1980</span><span class="op">:</span><span class="dv">1999</span>, <span class="dt">each =</span> <span class="dv">12</span>), <span class="dt">times =</span> <span class="dv">4</span>),</span>
<span id="cb11-38"><a href="#cb11-38"></a>    <span class="dt">month =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="dv">80</span>),</span>
<span id="cb11-39"><a href="#cb11-39"></a>    <span class="dt">watershed =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Upper Sacramento River'</span>, <span class="st">'Upper-mid Sacramento River'</span>, </span>
<span id="cb11-40"><a href="#cb11-40"></a>                      <span class="st">'Lower-mid Sacramento River'</span>, <span class="st">'Lower Sacramento River'</span>), <span class="dt">each =</span> <span class="dv">240</span>), </span>
<span id="cb11-41"><a href="#cb11-41"></a>    <span class="dt">hab_sq_m =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(up_sac_fp, up_mid_sac_fp, low_mid_sac_fp, low_sac_fp))</span>
<span id="cb11-42"><a href="#cb11-42"></a>  </span>
<span id="cb11-43"><a href="#cb11-43"></a>  hab &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(most, sac) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-44"><a href="#cb11-44"></a><span class="st">    </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span>(watershed, hab_sq_m) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-45"><a href="#cb11-45"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="st">`</span><span class="dt">Sutter Bypass</span><span class="st">`</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="ot">NA</span>, <span class="dv">240</span>),</span>
<span id="cb11-46"><a href="#cb11-46"></a>                     <span class="st">`</span><span class="dt">Yolo Bypass</span><span class="st">`</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="ot">NA</span>, <span class="dv">240</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-47"><a href="#cb11-47"></a><span class="st">    </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(watershed, habitat, <span class="op">-</span>year, <span class="op">-</span>month) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-48"><a href="#cb11-48"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">date =</span> lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(year, month, <span class="dv">1</span>, <span class="st">'-'</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-49"><a href="#cb11-49"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(date, watershed, habitat) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-50"><a href="#cb11-50"></a><span class="st">    </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span>(date, habitat) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-51"><a href="#cb11-51"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(cvpiaData<span class="op">::</span>watershed_ordering) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-52"><a href="#cb11-52"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(order) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-53"><a href="#cb11-53"></a><span class="st">    </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>watershed, <span class="op">-</span>order) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-54"><a href="#cb11-54"></a><span class="st">    </span><span class="kw"><a href="../reference/create_Sit_array.html">create_SIT_array</a></span>()</span>
<span id="cb11-55"><a href="#cb11-55"></a>  </span>
<span id="cb11-56"><a href="#cb11-56"></a>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(hab)</span>
<span id="cb11-57"><a href="#cb11-57"></a>  </span>
<span id="cb11-58"><a href="#cb11-58"></a>}</span></code></pre></div>
<p>To create habitat arrays for the different species, you can call the above function with the appropriate species argument.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>fr_fp &lt;-<span class="st"> </span><span class="kw">get_floodplain_hab_all</span>(<span class="st">'fr'</span>) <span class="co">#fall run</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>sr_fp &lt;-<span class="st"> </span><span class="kw">get_floodplain_hab_all</span>(<span class="st">'sr'</span>) <span class="co">#spring run</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>st_fp &lt;-<span class="st"> </span><span class="kw">get_floodplain_hab_all</span>(<span class="st">'st'</span>) <span class="co">#steelhead</span></span></code></pre></div>
<p>NOTE: The floodplain area is total wetted area and needs a suitability factor applied for all watersheds except the Sacramento Reaches, the Sutter and Yolo Bypasses, and the North and South Deltas which the floodplain area has already had a suitability criteria applied. See the apply suitability <a href="https://flowwest.github.io/cvpiaHabitat/reference/apply_suitability.html">function</a> for more details.</p>
<p>If you wish to modify the above function to make a new scenario, a possible way to override the default data output from <code><a href="../reference/load_baseline_data.html">cvpiaData::load_baseline_data</a></code> is as follows:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>all_model_inputs &lt;-<span class="st"> </span>cvpiaData<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cvpiaData/man/load_baseline_data.html">load_baseline_data</a></span>(<span class="st">'fall'</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co"># user must define get_floodplain_hab_all_modified to their specifications</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>all_model_inputs<span class="op">$</span>floodP &lt;-<span class="st"> </span><span class="kw">get_floodplain_hab_all_modified</span>(<span class="st">'fr'</span>)</span></code></pre></div>
<p>Or, you could swap out the watershedâ€™s values with a vector of new values. This vector must be of length 240, with the first value representing the habitat value for 01/1980 and the last 12/1999.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>fr_modified &lt;-<span class="st"> </span>cvpiaData<span class="op">::</span>fr_fp <span class="co">#copy baseline fall run floodplain rearing habitat</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>new_upper_sac_vals &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">240</span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="co"># upper sacramento is the first watershed, see cvpiaData::watershed_ordering</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>fr_modified[<span class="dv">1</span>,,] &lt;-<span class="st"> </span>new_upper_sac_vals </span>
<span id="cb14-5"><a href="#cb14-5"></a>all_model_inputs<span class="op">$</span>floodP &lt;-<span class="st"> </span>fr_modified[<span class="dv">1</span>,,]</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#helper-functions-and-libraries">Helper functions and Libraries</a></li>
      <li><a href="#spawning-habitat">Spawning Habitat</a></li>
      <li><a href="#rearing-habitat">Rearing Habitat</a></li>
      <li><a href="#floodplain-habitat">Floodplain Habitat</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Sadie Gill.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
